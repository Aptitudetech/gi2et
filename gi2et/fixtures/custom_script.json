[
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Project", 
  "modified": "2016-05-14 00:31:55.182509", 
  "name": "Project-Client", 
  "script": "frappe.ui.form.on(\"Project\", \"refresh\", function(doc) {\n\tcur_frm.set_df_property(\"github_repo\", \"read_only\", doc.__islocal ? 0 : 1);\n\tif(!doc.__islocal) {\n\t\tcur_frm.add_custom_button(__(\"Pull Github Issues\"), function(frm) {\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"gi2et.gi2et.api.get_gh_issues\",\n\t\t\t\targs: {\n\t\t\t\t\tgh_url: cur_frm.doc.github_repo\n\t\t\t\t},\n\t\t\t\tcallback: function (data) {\n\t\t\t\t\tif (cur_frm.doc.tasks.length == 0){\n\t\t\t\t\t\t$.each(data.message, function(i, d) {\n\t\t\t\t\t\t\t\tvar c = frappe.model.add_child(cur_frm.doc, \"Project Task\", \"tasks\");\n\t\t\t\t\t\t\t\tc.title = d.subject;\n\t\t\t\t\t\t\t\tc.status = d.status;\n\t\t\t\t\t\t\t\tc.start_date = d.exp_start_date;\n\t\t\t\t\t\t\t\tc.description = d.description;\n\t\t\t\t\t\t\t\tc.end_date = d.closing_date;\n\t\t\t\t\t\t\t\tc.github_id = d.github_id;\n\t\t\t\t\t\t\t\tc.github_number = d.github_number;\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tif(cur_frm.doc.tasks.length != 0){\n\t\t\t\t\t\tvar tasks = cur_frm.doc.tasks;\n\t\t\t\t\t\tfor (var i = 0; i < tasks; i++) {\n\t\t\t\t\t\t\tif(cur_frm.doc.tasks[i].task_id || cur_frm.doc.tasks[i].github_id == data.message[i].github_id){\n\t\t\t\t\t\t\t\tcur_frm.doc.tasks[i].title = data.message[i].subject;\n\t\t\t\t\t\t\t\tcur_frm.doc.tasks[i].status = data.message[i].status;\n\t\t\t\t\t\t\t\tcur_frm.doc.tasks[i].description = data.message[i].description;\n\t\t\t\t\t\t\t\tcur_frm.doc.tasks[i].end_date = data.message[i].closing_date;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse{\n\t\t\t\t\t\t\t\tvar c = frappe.model.add_child(cur_frm.doc, \"Project Task\", \"tasks\");\n\t\t\t\t\t\t\t\tc.title = d.subject;\n\t\t\t\t\t\t\t\tc.status = d.status;\n\t\t\t\t\t\t\t\tc.start_date = d.exp_start_date;\n\t\t\t\t\t\t\t\tc.description = d.description;\n\t\t\t\t\t\t\t\tc.end_date = d.closing_date;\n\t\t\t\t\t\t\t\tc.github_id = d.github_id;\n\t\t\t\t\t\t\t\tc.github_number = d.github_number;\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tcur_frm.refresh_field(\"tasks\");\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n});\n", 
  "script_type": "Client"
 }
]